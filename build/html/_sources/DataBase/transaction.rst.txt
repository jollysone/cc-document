####################################################################################################
**数据一致性**
####################################################################################################

******************************************************************************************
**加锁**
******************************************************************************************

单条语句加锁操作，只需加上 ``addForUpdate()`` 条件即可。

**注意：** 加锁后，如果有其他想修改该条记录的语句只能等待锁释放。以及锁全表问题。

.. code-block:: php
    :linenos:
    :emphasize-lines: 5

    <?php

        ItemModel::make($table)
            ->addId($id)
            ->addForUpdate()
            ->execute();

    ?>

    
******************************************************************************************
**事务操作**
******************************************************************************************

由于整个控制器业务逻辑复杂，需要开启事务保证整个业务流程的完善。成功后事务提交，有异常将会抛出并且回滚整个事务。

如果该控制器继承了 ``CAction`` , 则只需继承后重写 ``getIsOpenTransaction()`` 方法的返回值为 ``true`` 即可。

.. code-block:: php
    :linenos:
    :emphasize-lines: 5

    <?php

        protected function getIsOpenTransaction()
        {
            return true;
        }

    ?>




$transaction = \CC::app()->db->beginTransaction();
$transaction->commit();
$transaction->rollBack();