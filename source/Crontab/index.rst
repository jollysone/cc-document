####################################################################################################
**后台任务调度**
####################################################################################################

******************************************************************************************
**自启动流程**
******************************************************************************************




******************************************************************************************
**/cmd/core/bgtask/run运行机制**
******************************************************************************************






******************************************************************************************
**/cmd/core/bgtask/run运行机制**
******************************************************************************************


******************************************************************************************
**如何实现一个永久运行的后台任务?**
******************************************************************************************

```php
BgTaskServer::addTask('action_string', [], BgTaskServer::EXEC_TYPE_FORVER);
```
##### action_string对应的execute实现
```php
while(true) {
    
}
```
或者
```php
return BgTaskServer::execForeverInterval(function () {}, interval_times);
```

action_string对应的execute实现


******************************************************************************************
**如何实现一个一次运行的后台任务?**
******************************************************************************************

```php
BgTaskServer::addTask('action_string', [], BgTaskServer::EXEC_TYPE_ONCE);
```

action_string对应的execute实现正常返回即可







启动后台任务循环

http://host/proj/admin
关闭后台任务循环

http://host/proj/admin/core/bgtask/restart
调试后台任务

public function execute(CRequest $request) {
    $bg_task = ItemModel::make('bg_task')->addConditions([
        new NoComidCondition(),
        new EqualCondition('task_id','id'),
    ])
    ->execute();
    if (!$bg_task) {
        return new \CStringData('bg_task 不存在');
    }
    exec('php index.php ' . $bg_task['action'] . ' ' . $bg_task['id'], $out_put);
    return new \CStringData('输出结果：'.implode("\n<br>", $out_put));
}
后台任务无法重启

考虑runtime目录的权限